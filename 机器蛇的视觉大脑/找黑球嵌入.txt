clc;clear all;clear memory;i_src=imread('src.bmp');
i_gray=rgb2gray(i_src);i_bright = imadjust(i_gray,[0 0.5],[0 1]);level =graythresh(i_bright);i_segment=im2bw(i_bright,level);i_segment=im2double(i_segment);h=fspecial('gaussian',25,15);i_medfilt=medfilt2(i_segment,[3 3]);i_gaussian=imfilter(i_medfilt,h,'replicate');i_binary=im2bw(i_gaussian,1.5*graythresh(i_gaussian));[bin_y,bin_x]=size(i_binary);i_inverse=ones(bin_y,bin_x)-i_binary;[img_y,img_x]=size(i_inverse);mid_x=img_x/2;mid_y=img_y/2;i_connected=bwlabel(i_inverse);stats = regionprops(i_connected);Ar = cat(1, stats.Area);ind = find(Ar == max(Ar));i_maxcon = ismember(i_connected,ind);Volume = bwarea(i_maxcon)/(img_y*img_x);if Volume<0.005 offset=[0,0];return;else stat = regionprops(i_maxcon, 'centroid');centroids = cat(1, stat.Centroid);x=centroids(:,1);y=centroids(:,2);offset=[(x-mid_x)/mid_x,(y-mid_y)/mid_y];end;